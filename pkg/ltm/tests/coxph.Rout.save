
R version 3.2.2 (2015-08-14) -- "Fire Safety"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> library("sltm")
Loading required package: mlt
Loading required package: basefun
Loading required package: variables
> library("multcomp")
Loading required package: mvtnorm
Loading required package: survival
Loading required package: TH.data
> library("survival")
> data("GBSG2", package = "TH.data")
> storage.mode(GBSG2$time) <- "double"
> 
> msltm <- sltm(Surv(time, cens) | tgrade ~ horTh + menostat + pnodes, data = GBSG2, 
+               method = "cloglog", negative_lp = FALSE, order = 5)
Note: method with signature 'dsparseMatrix#dsparseMatrix' chosen for function 'kronecker',
 target signature 'dgTMatrix#dgCMatrix'.
 "TsparseMatrix#sparseMatrix" would also be valid
  Successful convergence.
> mcox <- coxph(Surv(time, cens) ~ horTh + menostat + pnodes + strata(tgrade), 
+               data = GBSG2)
> 
> print(msltm)

Call:
sltm(formula = Surv(time, cens) | tgrade ~ horTh + menostat + 
    pnodes, data = GBSG2, method = "cloglog", order = 5, negative_lp = FALSE)
Model: 
Coefficients:
  Bs1(time):tgradeI   Bs2(time):tgradeI   Bs3(time):tgradeI   Bs4(time):tgradeI 
         -9.6398482          -1.3275604          -1.3275604          -1.3275604 
  Bs5(time):tgradeI   Bs6(time):tgradeI  Bs1(time):tgradeII  Bs2(time):tgradeII 
         -1.3275604          -0.4611607          -5.3513891          -0.7322535 
 Bs3(time):tgradeII  Bs4(time):tgradeII  Bs5(time):tgradeII  Bs6(time):tgradeII 
         -0.7322535          -0.7322535          -0.4498750           0.1514630 
Bs1(time):tgradeIII Bs2(time):tgradeIII Bs3(time):tgradeIII Bs4(time):tgradeIII 
         -4.2325557          -0.4824990          -0.4824990          -0.4824990 
Bs5(time):tgradeIII Bs6(time):tgradeIII            horThyes        menostatPost 
         -0.4824990           0.3213415          -0.3876009           0.1395527 
             pnodes 
          0.0565349 
> print(mcox)
Call:
coxph(formula = Surv(time, cens) ~ horTh + menostat + pnodes + 
    strata(tgrade), data = GBSG2)


                 coef exp(coef) se(coef)     z       p
horThyes     -0.37180   0.68949  0.12861 -2.89  0.0038
menostatPost  0.13874   1.14883  0.12152  1.14  0.2536
pnodes        0.05422   1.05572  0.00685  7.92 2.4e-15

Likelihood ratio test=52.2  on 3 df, p=2.67e-11
n= 686, number of events= 299 
> 
> summary(msltm)

Call:
sltm(formula = Surv(time, cens) | tgrade ~ horTh + menostat + 
    pnodes, data = GBSG2, method = "cloglog", order = 5, negative_lp = FALSE)
Model:  continuous stratified linear transformation model (transformed minimum extreme value distribution)
	continuous stratified proportional hazards model
Coefficients (response transformation):
  Bs1(time):tgradeI   Bs2(time):tgradeI   Bs3(time):tgradeI   Bs4(time):tgradeI 
         -9.6398482          -1.3275604          -1.3275604          -1.3275604 
  Bs5(time):tgradeI   Bs6(time):tgradeI  Bs1(time):tgradeII  Bs2(time):tgradeII 
         -1.3275604          -0.4611607          -5.3513891          -0.7322535 
 Bs3(time):tgradeII  Bs4(time):tgradeII  Bs5(time):tgradeII  Bs6(time):tgradeII 
         -0.7322535          -0.7322535          -0.4498750           0.1514630 
Bs1(time):tgradeIII Bs2(time):tgradeIII Bs3(time):tgradeIII Bs4(time):tgradeIII 
         -4.2325557          -0.4824990          -0.4824990          -0.4824990 
Bs5(time):tgradeIII Bs6(time):tgradeIII 
         -0.4824990           0.3213415 

Coefficients (linear predictor):
                   Estimate Std. Error z value Pr(>|z|)    
horThyes == 0     -0.387601   0.128885  -3.007  0.00264 ** 
menostatPost == 0  0.139553   0.121507   1.149  0.25075    
pnodes == 0        0.056535   0.006815   8.295  < 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

AIC: 5208.382
Log-Likelihood: -2583.191 (df = 21)
> summary(mcox)
Call:
coxph(formula = Surv(time, cens) ~ horTh + menostat + pnodes + 
    strata(tgrade), data = GBSG2)

  n= 686, number of events= 299 

                  coef exp(coef)  se(coef)      z Pr(>|z|)    
horThyes     -0.371805  0.689489  0.128609 -2.891  0.00384 ** 
menostatPost  0.138744  1.148830  0.121524  1.142  0.25358    
pnodes        0.054221  1.055717  0.006848  7.917 2.44e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

             exp(coef) exp(-coef) lower .95 upper .95
horThyes        0.6895     1.4504    0.5359    0.8872
menostatPost    1.1488     0.8705    0.9053    1.4578
pnodes          1.0557     0.9472    1.0416    1.0700

Concordance= 0.644  (se = 0.024 )
Rsquare= 0.073   (max possible= 0.989 )
Likelihood ratio test= 52.23  on 3 df,   p=2.671e-11
Wald test            = 73.22  on 3 df,   p=8.882e-16
Score (logrank) test = 74.5  on 3 df,   p=4.441e-16

> 
> confint(msltm, calpha = univariate_calpha())

	 Simultaneous Confidence Intervals

Fit: NULL

Quantile = 1.96
95% confidence level
 

Linear Hypotheses:
                  Estimate lwr      upr     
horThyes == 0     -0.38760 -0.64021 -0.13499
menostatPost == 0  0.13955 -0.09860  0.37770
pnodes == 0        0.05653  0.04318  0.06989

> confint(mcox)
                   2.5 %      97.5 %
horThyes     -0.62387374 -0.11973612
menostatPost -0.09943788  0.37692668
pnodes        0.04079817  0.06764291
> 
> coef(msltm)
    horThyes menostatPost       pnodes 
  -0.3876009    0.1395527    0.0565349 
> coef(mcox)
    horThyes menostatPost       pnodes 
 -0.37180493   0.13874440   0.05422054 
> 
> vcov(msltm)
                  horThyes  menostatPost        pnodes
horThyes      0.0166113082 -3.360261e-03  3.503420e-05
menostatPost -0.0033602614  1.476389e-02 -1.325394e-05
pnodes        0.0000350342 -1.325394e-05  4.644830e-05
> vcov(mcox)
                  horThyes  menostatPost        pnodes
horThyes      1.654025e-02 -3.401211e-03  3.239249e-05
menostatPost -3.401211e-03  1.476804e-02 -1.741195e-05
pnodes        3.239249e-05 -1.741195e-05  4.689883e-05
> 
> summary(predict(msltm, newdata = GBSG2, type = "lp") - model.matrix(mcox) %*% coef(mcox))
       V1           
 Min.   :-0.013482  
 1st Qu.:-0.001910  
 Median : 0.004629  
 Mean   : 0.006398  
 3rd Qu.: 0.012380  
 Max.   : 0.118841  
> 
> nd <- expand.grid(horTh = sort(unique(GBSG2$horTh)), 
+                   menostat = sort(unique(GBSG2$menostat))[1L],
+                   pnodes = 30L, 
+                   tgrade = sort(unique(GBSG2$tgrade))[2L])
> 
> plot(survfit(mcox, newdata = nd, col = "grey"))
> plot(msltm, newdata = nd, type = "surv", add = TRUE, col = "red")
> 
> proc.time()
   user  system elapsed 
  2.386   0.073   2.483 
