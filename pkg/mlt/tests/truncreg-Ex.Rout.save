
R version 3.1.3 (2015-03-09) -- "Smooth Sidewalk"
Copyright (C) 2015 The R Foundation for Statistical Computing
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> library("mlt")
Loading required package: basefun
Loading required package: Matrix
Loading required package: polynom
Loading required package: numDeriv
> library("truncreg")
Loading required package: maxLik
Loading required package: miscTools

Please cite the 'maxLik' package as:
Henningsen, Arne and Toomet, Ott (2011). maxLik: A package for maximum likelihood estimation in R. Computational Statistics 26(3), 443-458. DOI 10.1007/s00180-010-0217-1.

If you have questions, suggestions, or comments regarding the 'maxLik' package, please use a forum or 'tracker' at maxLik's R-Forge site:
https://r-forge.r-project.org/projects/maxlik/

Attaching package: 'maxLik'

The following object is masked from 'package:numDeriv':

    hessian

> 
> 
> ## Left-truncated 
> set.seed(29)
> n <- 1000	
> x <- runif(n, max = 2 * pi)
> y <- rnorm(n, 2*x + 1, .25)
> d <- data.frame(y = y, x = x)
> ## truncated response
> tr <- 2.5
> d$yt <- ifelse(d$y > tr, d$y, NA)
> d$trunc_left <- tr
> 
> tmod <- truncreg(yt ~ x, data = d, point = tr, direction = "left")
> coef(tmod)
(Intercept)           x       sigma 
  1.0192835   1.9917670   0.2575485 
> logLik(tmod)
'log Lik.' -33.99032 (df=3)
> vcov(tmod)
              (Intercept)             x         sigma
(Intercept)  4.971662e-04 -1.146545e-04 -7.445133e-06
x           -1.146545e-04  3.145827e-05  1.637489e-06
sigma       -7.445133e-06  1.637489e-06  3.940881e-05
> 
> ## MLT
> fm <- as.formula("~ x")
> yb <- polynomial_basis(c(TRUE, TRUE), var = "yt", ci = c(-Inf, 0))
> m <- model(yb, shifting = fm, todistr = "Normal")
> mltmod <- mlt(m, data = d[!is.na(d$yt),,drop = FALSE], trunc = c("left" = "trunc_left"))
iter:  0  f-value:  2187.923  pgrad:  1110.073 
iter:  10  f-value:  397.3736  pgrad:  164.4466 
iter:  20  f-value:  50.01984  pgrad:  20.3993 
iter:  30  f-value:  66.15981  pgrad:  2057.124 
iter:  40  f-value:  33.99985  pgrad:  0.5886936 
iter:  50  f-value:  33.99059  pgrad:  0.190836 
iter:  60  f-value:  33.99035  pgrad:  0.9270303 
iter:  0  f-value:  33.99032  pgrad:  3.071742e-05 
Score: 1.000788  Hessian: 1.111817e-06 
Warning message:
In mlt(m, data = d[!is.na(d$yt), , drop = FALSE], trunc = c(left = "trunc_left")) :
  NB not met
> (cf <- coef(mltmod))
(Intercept)          yt           x 
  -3.957638    3.882764   -7.733562 
> c(-cf[1] / cf[2], -cf[3] / cf[2], 1 / cf[2])
(Intercept)           x          yt 
  1.0192835   1.9917670   0.2575485 
> logLik(mltmod)
'log Lik.' -33.99032 (df=3)
> vcov(mltmod)
             (Intercept)           yt           x
(Intercept)  0.017689298 -0.009565423  0.01722588
yt          -0.009565423  0.008956894 -0.01774419
x            0.017225878 -0.017744194  0.03562564
> 
> #library("numDeriv")
> 
> solve(numDeriv::hessian(mltmod$loglik, coef(mltmod)))
             [,1]         [,2]        [,3]
[1,]  0.017689298 -0.009565423  0.01722588
[2,] -0.009565423  0.008956894 -0.01774419
[3,]  0.017225878 -0.017744194  0.03562565
> 
> 
> ## right-truncated
> 
> set.seed(29)
> n <- 1000	
> x <- runif(n, max = 2 * pi)
> y <- rnorm(n, 2*x + 1, .25)
> d <- data.frame(y = y, x = x)
> ## truncated response
> tr <- 11
> d$yt <- ifelse(d$y < tr, d$y, NA)
> d$trunc_right <- tr
> 
> tmod <- truncreg(yt ~ x, data = d, point = tr, direction = "right")
> coef(tmod)
(Intercept)           x       sigma 
  1.0003424   1.9951261   0.2640064 
> logLik(tmod)
'log Lik.' -50.51895 (df=3)
> vcov(tmod)
              (Intercept)             x         sigma
(Intercept)  3.312328e-04 -1.021957e-04 -2.840592e-06
x           -1.021957e-04  4.352541e-05  1.854537e-06
sigma       -2.840592e-06  1.854537e-06  4.525610e-05
> 
> ## MLT
> fm <- as.formula("~ x")
> yb <- polynomial_basis(c(TRUE, TRUE), var = "yt", ci = c(-Inf, 0))
> m <- model(yb, shifting = fm, todistr = "Normal")
> mltmod <- mlt(m, data = d[!is.na(d$yt),,drop = FALSE], trunc = c("right" = "trunc_right"))
iter:  0  f-value:  1924.196  pgrad:  1319.759 
iter:  10  f-value:  555.5692  pgrad:  455.0789 
iter:  20  f-value:  477.8808  pgrad:  184.6084 
iter:  30  f-value:  238.196  pgrad:  76.99994 
iter:  40  f-value:  169.656  pgrad:  60.86556 
iter:  50  f-value:  142.8381  pgrad:  146.7454 
iter:  60  f-value:  103.8892  pgrad:  1486.475 
iter:  70  f-value:  86.19486  pgrad:  580.2425 
iter:  80  f-value:  51.04125  pgrad:  49.89992 
iter:  90  f-value:  50.53012  pgrad:  0.6351273 
iter:  100  f-value:  50.51895  pgrad:  0.02678399 
iter:  110  f-value:  50.51895  pgrad:  0.01003689 
iter:  0  f-value:  50.51895  pgrad:  1.267079e-06 
Score: 1.020367  Hessian: 0.4566856 
Warning messages:
1: In mlt(m, data = d[!is.na(d$yt), , drop = FALSE], trunc = c(right = "trunc_right")) :
  NB not met
2: In .log(mmprime %*% beta) :
  negative contribution to likelihood; model constraints violated!
3: In .log(mmprime %*% beta) :
  negative contribution to likelihood; model constraints violated!
4: In .log(.dealinf(mmtrunc$right, beta, offset, d$p, 1) - .dealinf(mmtrunc$left,  :
  negative contribution to likelihood; model constraints violated!
5: In .log(.dealinf(mmtrunc$right, beta, offset, d$p, 1) - .dealinf(mmtrunc$left,  :
  negative contribution to likelihood; model constraints violated!
6: In .log(.dealinf(mmtrunc$right, beta, offset, d$p, 1) - .dealinf(mmtrunc$left,  :
  negative contribution to likelihood; model constraints violated!
7: In .log(.dealinf(mmtrunc$right, beta, offset, d$p, 1) - .dealinf(mmtrunc$left,  :
  negative contribution to likelihood; model constraints violated!
8: In .log(.dealinf(mmtrunc$right, beta, offset, d$p, 1) - .dealinf(mmtrunc$left,  :
  negative contribution to likelihood; model constraints violated!
9: In spg(par = beta, fn = loglikfct, gr = scorefct, project = "projectLinear",  :
  convergence tolerance satisified at intial parameter values.
10: In .log(.dealinf(mmtrunc$right, beta, offset, d$p, 1) - .dealinf(mmtrunc$left,  :
  negative contribution to likelihood; model constraints violated!
> (cf <- coef(mltmod))
(Intercept)          yt           x 
  -3.789083    3.787786   -7.557111 
> c(-cf[1] / cf[2], -cf[3] / cf[2], 1 / cf[2])
(Intercept)           x          yt 
  1.0003424   1.9951261   0.2640064 
> logLik(mltmod)
'log Lik.' -50.51895 (df=3)
> vcov(mltmod)
             (Intercept)           yt           x
(Intercept)  0.014383309 -0.009473336  0.01733345
yt          -0.009473336  0.009315775 -0.01848536
x            0.017333447 -0.018485362  0.03730403
> 
> #library("numDeriv")
> 
> solve(numDeriv::hessian(mltmod$loglik, coef(mltmod)))
             [,1]         [,2]        [,3]
[1,]  0.014235534 -0.009322142  0.01703086
[2,] -0.009322142  0.009161311 -0.01817633
[3,]  0.017030861 -0.018176328  0.03668579
Warning message:
In .log(.dealinf(mmtrunc$right, beta, offset, d$p, 1) - .dealinf(mmtrunc$left,  :
  negative contribution to likelihood; model constraints violated!
> 
> 
> 
> proc.time()
   user  system elapsed 
  2.382   0.060   2.432 
