
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> ###
> ### Fit models for HCC data presented in
> ### 
> ###	On Nonparanormal Likelihoods
> ###	by Torsten Hothorn, UZH
> ###
> 
> set.seed(290875)
> 
> pkgs <- c("openxlsx", "tram", "survival")
> 
> ip <- rownames(installed.packages())
> if (any(!pkgs %in% ip))
+     install.packages(pkgs[!pkgs %in% ip], repos = "https://stat.ethz.ch/CRAN/")
> 
> OK <- sapply(pkgs, require, character.only = TRUE)
Loading required package: openxlsx
Loading required package: tram
Loading required package: mlt
Loading required package: basefun
Loading required package: variables
Loading required package: mvtnorm
Loading required package: survival
> if (!all(OK)) 
+     stop("package(s) ", paste(pkgs[!OK], collapse = ", "), " not available")
> 
> ### Load data
> dat <- read.xlsx("https://datadryad.org/api/v2/files/44697/download", sheet = 1)
> HCC <- with(dat, data.frame(id = 1:nrow(dat),
+                             x = factor(HCC_studyGr),
+                             AFP = log(AFP_ng_per_ml),
+                             PIV = log(PIVKA_delete_range),
+                             OPN = log(OPN),
+                             DKK = log(DKK)))
> ### limits of detection
> PIVm <- max(HCC$PIV)
> AFPm <- max(HCC$AFP)
> 
> ### marginal location-scale models
> mDKK <- BoxCox(
+     DKK ~                               ### probit, h(DKK) via Bernstein
+     x                                   ### location non-HCC / HCC
+     | x,                                ### scale non-HCC / HCC
+     data = HCC)
> mOPN <- BoxCox(OPN ~ x | x, data = HCC)
> HCC$PIVi <- with(HCC, R(       
+     Surv(PIV, event = PIV < PIVm),      ### right censoring
+     as.R.interval = TRUE))              ### empirical likelihood
> mPIV <- BoxCox(PIVi ~
+     x | x,                              ### location-scale
+     data = HCC)
> HCC$AFPi <- with(HCC, R(       
+     Surv(AFP, event = AFP < AFPm),      ### right censoring
+     as.R.interval = TRUE))              ### empirical likelihood
> mAFP <- BoxCox(AFPi ~ x | x,  data = HCC)
> 
> ### joint estimation of marginal and Gaussian copula parameters, s = 2
> ### location-scale transformation discriminant analysis
> m <- Mmlt(mDKK, mOPN, mPIV, mAFP, data = HCC)
> logLik(m)
'log Lik.' -5268.292 (df=42)
> ### marginal parameters
> coef(m, type = "marginal")
$DKK
DKK.Bs1(DKK) DKK.Bs2(DKK) DKK.Bs3(DKK) DKK.Bs4(DKK) DKK.Bs5(DKK) DKK.Bs6(DKK) 
  -2.8860663   -1.7777273   -1.7777272    0.3811799    3.0886712    3.0886712 
DKK.Bs7(DKK)       DKK.x1   DKK.scl_x1 
   4.5018079    0.5627226   -0.4732423 

$OPN
OPN.Bs1(OPN) OPN.Bs2(OPN) OPN.Bs3(OPN) OPN.Bs4(OPN) OPN.Bs5(OPN) OPN.Bs6(OPN) 
  -4.0679805   -3.0141535   -3.0141534    2.4288362    2.4288370    2.8095925 
OPN.Bs7(OPN)       OPN.x1   OPN.scl_x1 
   5.3197524    0.4542084   -0.9626001 

$PIVi
PIVi.Bs1(PIVi) PIVi.Bs2(PIVi) PIVi.Bs3(PIVi) PIVi.Bs4(PIVi) PIVi.Bs5(PIVi) 
    -2.2444712     -2.2444712     -0.7216030     -0.7215957     -0.4202699 
PIVi.Bs6(PIVi) PIVi.Bs7(PIVi)        PIVi.x1    PIVi.scl_x1 
     2.5199856      3.7231283      0.8814833     -0.6822877 

$AFPi
AFPi.Bs1(AFPi) AFPi.Bs2(AFPi) AFPi.Bs3(AFPi) AFPi.Bs4(AFPi) AFPi.Bs5(AFPi) 
    -1.8732722     -1.6481733     -1.2822734     -0.1125505     -0.1125506 
AFPi.Bs6(AFPi) AFPi.Bs7(AFPi)        AFPi.x1    AFPi.scl_x1 
     3.2467259      4.1670260      1.0711968     -0.7072025 

> ### copula parameter: Lambda
> coef(m, type = "Lambdapar")
, , 1

             DKK         OPN        PIVi        AFPi
DKK   1.00000000           .           .           .
OPN  -0.09844258  1.00000000           .           .
PIVi -0.29465007 -0.31416795  1.00000000           .
AFPi  0.03013268 -0.17995702 -1.32350223  1.00000000

> ### standard errors for all parameters
> sqrt(diag(vcov(m)))
         DKK.Bs1(DKK)          DKK.Bs2(DKK)          DKK.Bs3(DKK) 
           0.33620829            0.21449504            0.21449505 
         DKK.Bs4(DKK)          DKK.Bs5(DKK)          DKK.Bs6(DKK) 
           0.48575754            0.31881603            0.31881602 
         DKK.Bs7(DKK)                DKK.x1            DKK.scl_x1 
           0.57005294            0.09368866            0.14976722 
         OPN.Bs1(OPN)          OPN.Bs2(OPN)          OPN.Bs3(OPN) 
           0.49484997            0.22287052            0.22287053 
         OPN.Bs4(OPN)          OPN.Bs5(OPN)          OPN.Bs6(OPN) 
           0.24713434            0.24713434            0.65996211 
         OPN.Bs7(OPN)                OPN.x1            OPN.scl_x1 
           0.70003556            0.08611406            0.14862877 
       PIVi.Bs1(PIVi)        PIVi.Bs2(PIVi)        PIVi.Bs3(PIVi) 
           0.22186379            0.22186380            0.18960717 
       PIVi.Bs4(PIVi)        PIVi.Bs5(PIVi)        PIVi.Bs6(PIVi) 
           0.18964239            0.45167308            0.39990788 
       PIVi.Bs7(PIVi)               PIVi.x1           PIVi.scl_x1 
           0.33391840            0.09347833            0.15575973 
       AFPi.Bs1(AFPi)        AFPi.Bs2(AFPi)        AFPi.Bs3(AFPi) 
           0.20264025            0.31586777            0.41863960 
       AFPi.Bs4(AFPi)        AFPi.Bs5(AFPi)        AFPi.Bs6(AFPi) 
           0.20457082            0.20457082            0.36194168 
       AFPi.Bs7(AFPi)               AFPi.x1           AFPi.scl_x1 
           0.35412170            0.09675244            0.14774877 
  OPN.DKK.(Intercept)  PIVi.DKK.(Intercept)  PIVi.OPN.(Intercept) 
           0.05043256            0.05339106            0.05296356 
 AFPi.DKK.(Intercept)  AFPi.OPN.(Intercept) AFPi.PIVi.(Intercept) 
           0.05404243            0.05397081            0.09507275 
> 
> ### convex approximations
> ## pseudo
> mp <- Mmlt(mDKK, mOPN, mPIV, mAFP, data = HCC, fit = "pseudo")
> logLik(mp)
'log Lik.' -5295.351 (df=6)
> ## sequential
> ms <- Mmlt(mDKK, mOPN, mPIV, mAFP, data = HCC, fit = "sequential")
> logLik(ms)
'log Lik.' -5282.295 (df=12)
> ## ACS
> ma <- Mmlt(mDKK, mOPN, mPIV, mAFP, data = HCC, fit = "ACS", ACSiter = 1)
> logLik(ma)
'log Lik.' -5270.856 (df=6)
> 
> proc.time()
   user  system elapsed 
125.295   0.100 127.425 
