
R version 3.4.1 (2017-06-30) -- "Single Candle"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> library("trtf")
Loading required package: mlt
Loading required package: basefun
Loading required package: variables
Loading required package: partykit
Loading required package: grid

Attaching package: 'grid'

The following object is masked from 'package:variables':

    unit

Loading required package: libcoin
Loading required package: mvtnorm
> library("survival")
> data("GBSG2", package = "TH.data")
> set.seed(290875)
> 
> yvar <- numeric_var("y", support = c(100, 2000), bounds = c(0, Inf))
> By <- Bernstein_basis(yvar, order = 5, ui = "incre")
> m <- ctm(response = By, todistr = "MinExt")
> GBSG2$y <- with(GBSG2, Surv(time, cens))
> 
> tf <- traforest(m, formula = y ~ horTh + age + menostat + tsize + tgrade +
+     pnodes + progrec + estrec, data = GBSG2, 
+     control = ctree_control(splitstat = "quad", teststat = "quad",
+                     testtype = "Teststatistic", mincriterion = 1, minbucket = 50), 
+     ntree = 12, trace = FALSE, cores = 4)
> 
> predict(tf, newdata = GBSG2[1:3,], type = "weights")
       1 2 3
  [1,] 7 3 3
  [2,] 2 8 7
  [3,] 1 5 6
  [4,] 4 5 4
  [5,] 3 1 1
  [6,] 0 0 1
  [7,] 4 2 1
  [8,] 5 2 1
  [9,] 0 0 1
 [10,] 2 2 2
 [11,] 0 2 2
 [12,] 1 3 4
 [13,] 3 1 1
 [14,] 0 0 0
 [15,] 8 4 5
 [16,] 1 0 0
 [17,] 0 2 2
 [18,] 3 0 0
 [19,] 2 1 2
 [20,] 6 4 4
 [21,] 5 1 1
 [22,] 5 1 1
 [23,] 2 1 1
 [24,] 4 1 1
 [25,] 1 2 3
 [26,] 1 0 0
 [27,] 1 0 0
 [28,] 0 1 1
 [29,] 0 0 1
 [30,] 0 0 0
 [31,] 0 0 0
 [32,] 0 0 0
 [33,] 2 0 0
 [34,] 5 1 1
 [35,] 0 4 3
 [36,] 4 1 2
 [37,] 2 1 2
 [38,] 2 7 6
 [39,] 1 1 1
 [40,] 0 6 4
 [41,] 0 4 4
 [42,] 0 4 3
 [43,] 2 1 1
 [44,] 1 0 0
 [45,] 1 0 1
 [46,] 3 1 1
 [47,] 3 1 1
 [48,] 0 1 1
 [49,] 1 5 5
 [50,] 3 4 5
 [51,] 2 1 1
 [52,] 0 0 0
 [53,] 5 1 1
 [54,] 0 2 3
 [55,] 0 3 2
 [56,] 4 2 2
 [57,] 2 6 6
 [58,] 1 1 1
 [59,] 0 0 0
 [60,] 1 5 3
 [61,] 1 2 3
 [62,] 3 2 1
 [63,] 2 0 0
 [64,] 0 4 3
 [65,] 0 0 1
 [66,] 0 0 0
 [67,] 0 0 0
 [68,] 1 4 5
 [69,] 0 1 0
 [70,] 0 0 0
 [71,] 0 5 3
 [72,] 0 0 0
 [73,] 0 1 2
 [74,] 2 2 2
 [75,] 2 5 5
 [76,] 1 0 0
 [77,] 0 0 0
 [78,] 0 0 0
 [79,] 0 1 2
 [80,] 8 3 3
 [81,] 0 1 2
 [82,] 0 0 0
 [83,] 0 0 1
 [84,] 0 2 2
 [85,] 0 3 2
 [86,] 0 0 1
 [87,] 6 3 2
 [88,] 0 1 2
 [89,] 1 1 2
 [90,] 1 0 0
 [91,] 2 3 5
 [92,] 3 0 0
 [93,] 1 0 0
 [94,] 3 1 1
 [95,] 5 0 0
 [96,] 0 0 0
 [97,] 2 2 3
 [98,] 2 0 0
 [99,] 0 1 2
[100,] 1 0 0
[101,] 0 0 1
[102,] 0 1 1
[103,] 0 4 3
[104,] 2 4 3
[105,] 4 2 2
[106,] 0 1 2
[107,] 0 0 0
[108,] 1 5 4
[109,] 4 0 0
[110,] 5 1 1
[111,] 6 1 1
[112,] 4 2 1
[113,] 1 1 2
[114,] 1 0 0
[115,] 1 3 2
[116,] 2 5 5
[117,] 0 0 0
[118,] 1 1 2
[119,] 0 0 1
[120,] 0 0 0
[121,] 1 0 0
[122,] 0 0 0
[123,] 1 0 0
[124,] 0 0 0
[125,] 2 2 3
[126,] 4 2 1
[127,] 0 1 2
[128,] 3 8 7
[129,] 2 2 3
[130,] 0 0 1
[131,] 1 1 2
[132,] 3 0 0
[133,] 1 1 0
[134,] 0 3 2
[135,] 0 0 1
[136,] 1 1 2
[137,] 0 0 1
[138,] 3 2 1
[139,] 0 0 0
[140,] 2 0 0
[141,] 1 1 2
[142,] 8 3 3
[143,] 2 0 0
[144,] 1 0 1
[145,] 1 1 2
[146,] 1 2 2
[147,] 0 0 0
[148,] 1 0 1
[149,] 0 1 1
[150,] 8 3 3
[151,] 0 2 2
[152,] 0 0 0
[153,] 2 6 5
[154,] 0 1 1
[155,] 2 6 5
[156,] 0 2 3
[157,] 1 0 1
[158,] 1 1 1
[159,] 1 2 3
[160,] 0 1 1
[161,] 0 2 2
[162,] 2 0 0
[163,] 1 4 5
[164,] 0 4 3
[165,] 0 0 0
[166,] 2 4 3
[167,] 0 2 3
[168,] 4 0 0
[169,] 1 4 3
[170,] 0 1 0
[171,] 0 2 3
[172,] 0 2 3
[173,] 0 0 0
[174,] 3 8 7
[175,] 0 0 0
[176,] 0 0 0
[177,] 0 0 1
[178,] 3 1 2
[179,] 0 1 2
[180,] 3 1 1
[181,] 1 1 1
[182,] 0 0 0
[183,] 2 1 2
[184,] 3 1 2
[185,] 1 7 7
[186,] 3 1 1
[187,] 1 3 3
[188,] 4 0 0
[189,] 4 0 0
[190,] 0 1 2
[191,] 2 1 2
[192,] 0 3 4
[193,] 0 2 3
[194,] 3 1 1
[195,] 1 5 4
[196,] 6 5 5
[197,] 1 0 0
[198,] 3 0 0
[199,] 1 1 1
[200,] 2 4 5
[201,] 1 0 0
[202,] 2 0 0
[203,] 2 0 1
[204,] 4 1 1
[205,] 0 0 0
[206,] 1 0 0
[207,] 0 1 2
[208,] 2 0 0
[209,] 3 2 1
[210,] 0 0 0
[211,] 5 1 1
[212,] 1 0 0
[213,] 6 2 2
[214,] 3 5 5
[215,] 0 2 3
[216,] 2 0 0
[217,] 1 0 0
[218,] 1 2 4
[219,] 0 1 2
[220,] 0 0 0
[221,] 2 1 1
[222,] 4 1 1
[223,] 0 0 0
[224,] 2 0 0
[225,] 0 1 0
[226,] 0 0 1
[227,] 0 0 1
[228,] 0 1 2
[229,] 2 1 1
[230,] 3 1 1
[231,] 0 2 2
[232,] 0 0 0
[233,] 5 3 3
[234,] 0 2 2
[235,] 1 0 0
[236,] 2 0 0
[237,] 3 5 5
[238,] 0 3 3
[239,] 2 3 5
[240,] 3 0 0
[241,] 4 1 2
[242,] 0 0 1
[243,] 5 1 1
[244,] 0 2 3
[245,] 1 0 0
[246,] 2 0 0
[247,] 4 1 1
[248,] 0 0 2
[249,] 1 0 0
[250,] 0 1 1
[251,] 1 1 2
[252,] 0 0 0
[253,] 0 0 0
[254,] 4 5 7
[255,] 0 0 0
[256,] 0 1 1
[257,] 1 1 1
[258,] 0 0 1
[259,] 1 0 0
[260,] 1 0 0
[261,] 1 2 2
[262,] 1 1 3
[263,] 0 0 0
[264,] 0 0 2
[265,] 0 0 0
[266,] 0 0 0
[267,] 3 0 0
[268,] 2 0 0
[269,] 0 1 1
[270,] 0 0 0
[271,] 0 1 0
[272,] 0 5 4
[273,] 2 4 5
[274,] 1 0 0
[275,] 3 2 3
[276,] 3 4 4
[277,] 1 0 0
[278,] 1 0 0
[279,] 3 3 3
[280,] 4 0 0
[281,] 1 2 1
[282,] 0 1 1
[283,] 3 1 1
[284,] 1 2 3
[285,] 2 0 0
[286,] 0 0 1
[287,] 1 2 1
[288,] 3 6 7
[289,] 0 0 0
[290,] 3 6 5
[291,] 1 5 5
[292,] 7 5 5
[293,] 2 2 1
[294,] 4 1 1
[295,] 2 1 0
[296,] 0 0 1
[297,] 0 2 3
[298,] 1 1 0
[299,] 1 1 1
[300,] 0 0 0
[301,] 1 1 2
[302,] 2 0 1
[303,] 1 4 3
[304,] 3 9 9
[305,] 0 4 3
[306,] 5 1 1
[307,] 1 0 0
[308,] 1 0 1
[309,] 0 1 2
[310,] 2 0 0
[311,] 1 0 0
[312,] 0 0 0
[313,] 0 3 3
[314,] 2 6 7
[315,] 1 0 0
[316,] 0 0 1
[317,] 2 8 7
[318,] 0 1 2
[319,] 0 0 0
[320,] 3 1 1
[321,] 0 1 2
[322,] 0 1 1
[323,] 0 6 5
[324,] 1 0 0
[325,] 2 0 0
[326,] 0 1 2
[327,] 0 0 0
[328,] 0 0 0
[329,] 0 1 2
[330,] 1 1 2
[331,] 1 3 3
[332,] 0 2 3
[333,] 6 6 6
[334,] 4 1 1
[335,] 7 0 0
[336,] 0 1 2
[337,] 0 0 0
[338,] 0 1 0
[339,] 4 1 1
[340,] 1 1 1
[341,] 0 5 4
[342,] 0 0 0
[343,] 1 1 2
[344,] 1 6 6
[345,] 1 0 0
[346,] 0 0 1
[347,] 0 0 0
[348,] 2 4 3
[349,] 0 1 2
[350,] 4 0 0
[351,] 1 1 2
[352,] 0 0 0
[353,] 4 0 0
[354,] 0 1 1
[355,] 6 4 4
[356,] 1 3 2
[357,] 3 2 1
[358,] 0 0 1
[359,] 2 0 0
[360,] 1 2 3
[361,] 0 0 0
[362,] 2 7 7
[363,] 0 1 1
[364,] 0 0 0
[365,] 4 1 2
[366,] 1 0 0
[367,] 2 5 5
[368,] 2 5 6
[369,] 2 0 0
[370,] 1 1 0
[371,] 4 8 7
[372,] 7 2 2
[373,] 1 0 0
[374,] 0 0 0
[375,] 0 0 0
[376,] 6 2 2
[377,] 2 2 2
[378,] 0 0 0
[379,] 1 0 0
[380,] 0 1 2
[381,] 1 0 0
[382,] 0 1 1
[383,] 0 0 0
[384,] 3 5 5
[385,] 0 1 0
[386,] 0 4 3
[387,] 1 2 1
[388,] 1 0 0
[389,] 1 1 1
[390,] 0 0 1
[391,] 0 5 5
[392,] 2 5 5
[393,] 3 8 7
[394,] 0 1 0
[395,] 0 0 0
[396,] 0 4 4
[397,] 1 0 0
[398,] 0 0 1
[399,] 1 1 1
[400,] 4 1 1
[401,] 0 0 0
[402,] 2 1 1
[403,] 7 3 3
[404,] 0 0 0
[405,] 5 2 1
[406,] 0 0 0
[407,] 0 1 0
[408,] 0 4 4
[409,] 2 6 5
[410,] 0 1 0
[411,] 1 0 0
[412,] 1 2 3
[413,] 1 6 5
[414,] 4 4 3
[415,] 0 5 3
[416,] 0 0 0
[417,] 0 1 2
[418,] 0 1 2
[419,] 2 2 2
[420,] 3 1 1
[421,] 0 1 1
[422,] 0 0 0
[423,] 0 0 0
[424,] 0 0 0
[425,] 0 0 0
[426,] 0 5 4
[427,] 0 0 0
[428,] 4 8 8
[429,] 2 8 9
[430,] 4 1 1
[431,] 0 0 0
[432,] 2 5 4
[433,] 0 2 1
[434,] 0 0 0
[435,] 1 0 0
[436,] 1 2 1
[437,] 0 0 0
[438,] 0 2 3
[439,] 0 0 0
[440,] 1 2 3
[441,] 1 1 1
[442,] 0 1 2
[443,] 0 1 2
[444,] 1 0 0
[445,] 2 6 6
[446,] 1 0 0
[447,] 3 0 0
[448,] 0 0 0
[449,] 0 0 0
[450,] 2 1 2
[451,] 0 0 0
[452,] 3 1 1
[453,] 4 1 1
[454,] 5 2 3
[455,] 1 2 2
[456,] 1 0 0
[457,] 0 0 0
[458,] 0 0 0
[459,] 0 4 3
[460,] 2 1 0
[461,] 2 6 5
[462,] 0 4 4
[463,] 4 1 1
[464,] 1 6 5
[465,] 1 1 2
[466,] 0 0 0
[467,] 3 2 1
[468,] 1 0 0
[469,] 0 1 2
[470,] 0 1 0
[471,] 1 0 0
[472,] 0 1 2
[473,] 0 0 0
[474,] 7 1 1
[475,] 0 0 0
[476,] 1 5 4
[477,] 2 1 1
[478,] 0 5 5
[479,] 0 0 1
[480,] 0 0 0
[481,] 5 3 3
[482,] 0 1 0
[483,] 0 0 1
[484,] 2 2 4
[485,] 2 1 1
[486,] 3 1 1
[487,] 1 7 6
[488,] 0 1 0
[489,] 2 0 1
[490,] 0 0 0
[491,] 3 1 1
[492,] 6 3 3
[493,] 0 0 1
[494,] 2 0 0
[495,] 5 1 2
[496,] 1 1 1
[497,] 0 0 1
[498,] 8 1 1
[499,] 3 0 0
[500,] 0 0 0
[501,] 3 0 0
[502,] 2 1 2
[503,] 1 1 1
[504,] 1 0 1
[505,] 0 4 3
[506,] 1 2 3
[507,] 2 0 0
[508,] 3 5 7
[509,] 4 4 4
[510,] 1 0 1
[511,] 0 1 1
[512,] 0 0 0
[513,] 5 1 1
[514,] 0 1 2
[515,] 0 0 1
[516,] 4 5 4
[517,] 0 0 0
[518,] 1 1 1
[519,] 1 2 2
[520,] 1 3 2
[521,] 1 3 3
[522,] 3 3 2
[523,] 2 1 1
[524,] 0 1 1
[525,] 0 0 0
[526,] 3 2 1
[527,] 0 0 0
[528,] 2 0 0
[529,] 4 2 2
[530,] 0 1 2
[531,] 0 1 1
[532,] 3 2 2
[533,] 0 1 2
[534,] 4 6 6
[535,] 0 0 0
[536,] 3 6 7
[537,] 0 0 1
[538,] 2 0 0
[539,] 0 0 0
[540,] 5 0 0
[541,] 1 0 0
[542,] 0 0 0
[543,] 0 0 0
[544,] 1 6 5
[545,] 4 2 1
[546,] 0 0 1
[547,] 0 0 0
[548,] 1 2 2
[549,] 1 0 0
[550,] 1 2 3
[551,] 1 3 3
[552,] 1 1 0
[553,] 3 0 0
[554,] 4 0 0
[555,] 2 2 3
[556,] 0 2 3
[557,] 2 1 1
[558,] 2 8 7
[559,] 0 6 5
[560,] 0 1 1
[561,] 0 1 0
[562,] 1 2 2
[563,] 0 1 2
[564,] 2 8 7
[565,] 6 2 2
[566,] 0 0 0
[567,] 4 1 1
[568,] 2 1 1
[569,] 1 4 3
[570,] 3 7 5
[571,] 0 0 1
[572,] 0 0 0
[573,] 1 0 0
[574,] 0 0 0
[575,] 0 0 0
[576,] 0 0 0
[577,] 1 0 0
[578,] 0 0 0
[579,] 0 1 2
[580,] 0 0 0
[581,] 0 1 2
[582,] 1 2 3
[583,] 2 0 0
[584,] 5 2 1
[585,] 3 8 8
[586,] 0 1 0
[587,] 1 0 0
[588,] 1 1 2
[589,] 0 1 2
[590,] 0 0 1
[591,] 0 0 0
[592,] 0 1 1
[593,] 0 0 0
[594,] 3 1 1
[595,] 1 0 0
[596,] 3 5 5
[597,] 3 5 6
[598,] 1 1 1
[599,] 1 2 1
[600,] 1 0 1
[601,] 0 0 1
[602,] 0 0 0
[603,] 4 5 5
[604,] 0 0 0
[605,] 4 0 0
[606,] 0 5 4
[607,] 2 0 0
[608,] 1 3 4
[609,] 3 1 0
[610,] 0 0 0
[611,] 0 2 2
[612,] 1 0 0
[613,] 1 0 0
[614,] 0 0 1
[615,] 1 0 1
[616,] 4 1 1
[617,] 0 5 4
[618,] 0 1 1
[619,] 0 0 0
[620,] 3 6 7
[621,] 3 7 6
[622,] 0 0 0
[623,] 0 0 0
[624,] 0 0 0
[625,] 0 3 3
[626,] 2 2 3
[627,] 3 3 2
[628,] 0 0 0
[629,] 4 4 4
[630,] 0 0 0
[631,] 0 0 0
[632,] 0 1 2
[633,] 0 0 1
[634,] 3 1 1
[635,] 2 1 0
[636,] 1 7 7
[637,] 1 0 0
[638,] 1 0 0
[639,] 0 0 0
[640,] 1 0 0
[641,] 0 0 0
[642,] 1 1 2
[643,] 4 0 0
[644,] 0 0 1
[645,] 0 0 0
[646,] 0 0 0
[647,] 3 1 2
[648,] 2 0 0
[649,] 0 0 1
[650,] 7 2 2
[651,] 0 0 0
[652,] 1 0 0
[653,] 0 2 2
[654,] 0 2 3
[655,] 0 0 0
[656,] 0 0 0
[657,] 0 0 1
[658,] 2 0 0
[659,] 0 0 0
[660,] 2 5 4
[661,] 2 1 1
[662,] 2 1 2
[663,] 1 0 0
[664,] 0 0 0
[665,] 0 0 1
[666,] 6 2 2
[667,] 0 1 0
[668,] 3 0 0
[669,] 0 0 0
[670,] 4 1 1
[671,] 0 1 1
[672,] 4 1 1
[673,] 0 0 0
[674,] 1 0 0
[675,] 4 0 1
[676,] 2 0 0
[677,] 2 8 7
[678,] 0 0 0
[679,] 4 8 8
[680,] 0 3 3
[681,] 2 3 4
[682,] 0 0 0
[683,] 0 0 0
[684,] 0 3 3
[685,] 1 1 1
[686,] 2 3 3
> predict(tf, newdata = GBSG2[1:3,], type = "node")
[[1]]
[1]  5 13 13

[[2]]
[1]  8 11 10

[[3]]
[1]  6  3 10

[[4]]
[1]  7 10 10

[[5]]
[1]  8 11 11

[[6]]
[1] 10 10 10

[[7]]
[1] 6 9 9

[[8]]
[1]  8 13 13

[[9]]
[1] 10 11 11

[[10]]
[1] 10 10 10

[[11]]
[1] 12 12 12

[[12]]
[1] 9 9 9

> (cf <- predict(tf, newdata = GBSG2[1:3,], type = "coef"))
$`1`
    Bs1(y)     Bs2(y)     Bs3(y)     Bs4(y)     Bs5(y)     Bs6(y) 
-5.9635153 -0.8800030 -0.8800030 -0.8800030 -0.5246055 -0.2448762 

$`2`
    Bs1(y)     Bs2(y)     Bs3(y)     Bs4(y)     Bs5(y)     Bs6(y) 
-4.7219260 -0.7197854 -0.7197854 -0.5223062 -0.5223063 -0.1208680 

$`3`
     Bs1(y)      Bs2(y)      Bs3(y)      Bs4(y)      Bs5(y)      Bs6(y) 
-4.45883305 -0.61157362 -0.61157363 -0.43112181 -0.43112183 -0.05586835 

> 
> logLik(tf, newdata = GBSG2[1:3,])
'log Lik.' -23.64083 (df=NA)
> 
> sapply(1:length(tf$nodes), function(i) logLik(gettree(tf, i)))
 [1] -2563.701 -2549.876 -2592.580 -2564.824 -2563.474 -2575.891 -2562.134
 [8] -2548.373 -2557.507 -2576.231 -2565.654 -2591.380
> 
> varimp(tf)
    horTh       age  menostat     tsize    tgrade    pnodes   progrec    estrec 
14.343661 12.396678  8.068807  7.649014 23.677684 72.062829 39.086286 12.018243 
> 
> mod <- mlt(m, data = GBSG2)
> logLik(mod)
'log Lik.' -2618.714 (df=6)
> 
> logLik(mod, newdata = GBSG2[1:3,])
'log Lik.' -24.62884 (df=NULL)
> 
> layout(matrix(1:2, nr = 1))
> coef(mod) <- cf[[1]]
> plot(mod, newdata = data.frame(1), type = "survivor")
> coef(mod) <- cf[[2]]
> plot(mod, newdata = data.frame(1), type = "survivor", add = TRUE)
> coef(mod) <- cf[[3]]
> plot(mod, newdata = data.frame(1), type = "survivor", add = TRUE)
> 
> simulate(tf, newdata = GBSG2[1:3,], nsim = 3)
[[1]]
[1] (2000, Inf] (2000, Inf] (2000, Inf]

[[2]]
[1] 1100.7567505004  544.810261781418 (2000, Inf]     

[[3]]
[1] 949.206862191121 (2000, Inf]      (2000, Inf]     

> 
> cmod <- coxph(Surv(time, cens) ~ horTh + age + menostat + tsize + tgrade +
+     pnodes + progrec + estrec, data = GBSG2)
> 
> plot(survfit(cmod, newdata = GBSG2[1:3,]))
> 
> proc.time()
   user  system elapsed 
 13.272   0.620  11.575 
