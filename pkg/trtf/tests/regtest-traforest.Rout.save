
R Under development (unstable) (2017-12-13 r73907) -- "Unsuffered Consequences"
Copyright (C) 2017 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> 
> library("trtf")
Loading required package: mlt
Loading required package: basefun
Loading required package: variables
Loading required package: partykit
Loading required package: grid

Attaching package: 'grid'

The following object is masked from 'package:variables':

    unit

Loading required package: libcoin
Loading required package: mvtnorm
Loading required package: rpart
> library("survival")
> library("partykit")
> data("GBSG2", package = "TH.data")
> set.seed(290875)
> 
> yvar <- numeric_var("y", support = c(100, 2000), bounds = c(0, Inf))
> By <- Bernstein_basis(yvar, order = 5, ui = "incre")
> m <- ctm(response = By, todistr = "MinExt")
> GBSG2$y <- with(GBSG2, Surv(time, cens))
> 
> tf <- traforest(m, formula = y ~ horTh + age + menostat + tsize + tgrade +
+     pnodes + progrec + estrec, data = GBSG2, 
+     control = ctree_control(splitstat = "quad", teststat = "quad",
+                     testtype = "Teststatistic", mincriterion = 1, minbucket = 50), 
+     ntree = 12, trace = FALSE, cores = 1)
> 
> predict(tf, newdata = GBSG2[1:3,], type = "weights")
       1 2 3
  [1,] 7 2 0
  [2,] 2 8 6
  [3,] 0 3 7
  [4,] 2 4 2
  [5,] 4 0 0
  [6,] 0 1 2
  [7,] 1 2 1
  [8,] 3 2 0
  [9,] 1 2 5
 [10,] 2 3 1
 [11,] 0 1 3
 [12,] 2 4 3
 [13,] 0 1 1
 [14,] 2 0 0
 [15,] 2 2 2
 [16,] 2 0 0
 [17,] 1 0 1
 [18,] 1 1 1
 [19,] 1 2 3
 [20,] 2 0 3
 [21,] 4 0 0
 [22,] 3 1 0
 [23,] 0 0 0
 [24,] 2 3 1
 [25,] 0 1 2
 [26,] 0 0 0
 [27,] 1 1 0
 [28,] 1 1 1
 [29,] 0 1 1
 [30,] 0 0 0
 [31,] 0 0 0
 [32,] 1 0 0
 [33,] 0 0 0
 [34,] 6 1 1
 [35,] 1 2 1
 [36,] 0 1 0
 [37,] 1 2 4
 [38,] 1 4 5
 [39,] 5 0 0
 [40,] 2 6 3
 [41,] 1 4 4
 [42,] 0 1 2
 [43,] 0 0 0
 [44,] 1 1 0
 [45,] 3 2 1
 [46,] 7 1 0
 [47,] 4 1 0
 [48,] 0 1 2
 [49,] 1 5 4
 [50,] 2 3 6
 [51,] 2 3 3
 [52,] 2 0 0
 [53,] 4 1 1
 [54,] 0 1 1
 [55,] 0 1 2
 [56,] 3 0 1
 [57,] 0 2 2
 [58,] 1 1 1
 [59,] 2 1 1
 [60,] 2 5 3
 [61,] 0 2 3
 [62,] 8 4 1
 [63,] 6 0 0
 [64,] 1 5 5
 [65,] 0 1 1
 [66,] 1 0 0
 [67,] 0 1 1
 [68,] 1 5 4
 [69,] 0 1 1
 [70,] 0 0 0
 [71,] 1 3 2
 [72,] 1 0 0
 [73,] 1 3 4
 [74,] 1 2 3
 [75,] 0 1 2
 [76,] 2 2 1
 [77,] 2 1 0
 [78,] 1 0 0
 [79,] 0 0 1
 [80,] 3 1 1
 [81,] 0 1 2
 [82,] 0 0 0
 [83,] 0 0 0
 [84,] 1 3 2
 [85,] 0 3 4
 [86,] 1 0 1
 [87,] 8 3 0
 [88,] 0 1 1
 [89,] 0 2 6
 [90,] 1 0 0
 [91,] 1 0 2
 [92,] 3 0 0
 [93,] 0 0 0
 [94,] 5 0 0
 [95,] 4 1 0
 [96,] 0 0 0
 [97,] 2 0 1
 [98,] 2 0 0
 [99,] 0 0 0
[100,] 1 0 0
[101,] 0 0 1
[102,] 2 0 1
[103,] 0 1 2
[104,] 0 2 7
[105,] 3 0 0
[106,] 0 2 2
[107,] 1 0 1
[108,] 1 1 2
[109,] 5 1 0
[110,] 2 1 1
[111,] 4 1 1
[112,] 1 0 0
[113,] 1 2 3
[114,] 0 0 0
[115,] 1 4 4
[116,] 0 2 4
[117,] 2 1 0
[118,] 2 2 2
[119,] 0 1 1
[120,] 0 0 0
[121,] 2 0 0
[122,] 0 0 0
[123,] 0 0 0
[124,] 0 0 0
[125,] 1 1 1
[126,] 4 1 0
[127,] 0 1 2
[128,] 1 3 5
[129,] 2 1 0
[130,] 1 2 0
[131,] 0 1 1
[132,] 1 0 0
[133,] 6 2 0
[134,] 0 3 4
[135,] 0 0 0
[136,] 1 2 1
[137,] 0 0 0
[138,] 2 2 0
[139,] 0 0 0
[140,] 1 1 0
[141,] 0 1 3
[142,] 7 2 0
[143,] 4 3 0
[144,] 0 0 0
[145,] 2 4 1
[146,] 0 0 0
[147,] 3 1 0
[148,] 1 1 2
[149,] 0 2 3
[150,] 2 0 2
[151,] 1 4 3
[152,] 4 1 0
[153,] 0 1 2
[154,] 1 0 0
[155,] 0 5 8
[156,] 0 2 2
[157,] 2 2 1
[158,] 0 0 0
[159,] 1 1 1
[160,] 2 1 1
[161,] 1 3 2
[162,] 2 0 0
[163,] 0 2 3
[164,] 0 2 2
[165,] 0 0 0
[166,] 1 2 5
[167,] 1 1 1
[168,] 5 0 1
[169,] 0 1 3
[170,] 1 3 3
[171,] 0 2 3
[172,] 0 3 4
[173,] 1 0 0
[174,] 0 4 5
[175,] 0 0 0
[176,] 1 0 0
[177,] 1 2 0
[178,] 0 1 2
[179,] 1 1 2
[180,] 1 3 1
[181,] 2 3 3
[182,] 1 0 0
[183,] 0 2 1
[184,] 2 1 1
[185,] 2 6 4
[186,] 0 0 0
[187,] 0 2 2
[188,] 3 2 0
[189,] 5 0 0
[190,] 1 2 2
[191,] 2 1 0
[192,] 0 0 1
[193,] 0 1 1
[194,] 2 4 1
[195,] 1 2 5
[196,] 0 1 2
[197,] 2 0 0
[198,] 4 1 0
[199,] 0 3 4
[200,] 0 3 4
[201,] 1 0 0
[202,] 0 0 0
[203,] 2 1 1
[204,] 6 0 0
[205,] 1 0 0
[206,] 0 0 0
[207,] 0 1 2
[208,] 2 0 0
[209,] 3 1 0
[210,] 1 0 0
[211,] 4 0 2
[212,] 1 0 0
[213,] 0 0 3
[214,] 2 5 3
[215,] 0 3 3
[216,] 2 2 0
[217,] 1 0 0
[218,] 1 3 5
[219,] 1 1 0
[220,] 0 1 0
[221,] 1 2 1
[222,] 3 0 1
[223,] 0 0 0
[224,] 4 0 0
[225,] 1 0 0
[226,] 0 3 1
[227,] 0 0 1
[228,] 1 3 5
[229,] 2 0 0
[230,] 3 2 1
[231,] 2 4 2
[232,] 0 0 0
[233,] 3 3 0
[234,] 0 1 1
[235,] 1 0 0
[236,] 0 2 1
[237,] 2 4 7
[238,] 1 3 3
[239,] 1 6 3
[240,] 4 2 0
[241,] 0 0 0
[242,] 1 1 0
[243,] 1 1 0
[244,] 1 3 3
[245,] 0 0 0
[246,] 2 1 0
[247,] 1 0 0
[248,] 0 1 3
[249,] 0 1 1
[250,] 0 0 0
[251,] 1 1 2
[252,] 1 0 0
[253,] 0 0 0
[254,] 1 2 3
[255,] 1 0 0
[256,] 4 2 1
[257,] 0 2 2
[258,] 1 1 0
[259,] 1 2 1
[260,] 0 0 0
[261,] 0 5 5
[262,] 0 3 5
[263,] 2 0 0
[264,] 1 2 3
[265,] 0 0 0
[266,] 0 1 0
[267,] 1 0 0
[268,] 1 0 0
[269,] 0 1 1
[270,] 0 0 0
[271,] 1 1 0
[272,] 1 1 0
[273,] 0 4 5
[274,] 0 0 0
[275,] 2 1 1
[276,] 0 5 7
[277,] 0 0 0
[278,] 0 0 0
[279,] 4 0 3
[280,] 9 1 1
[281,] 3 4 1
[282,] 0 0 0
[283,] 3 0 0
[284,] 0 1 2
[285,] 4 0 0
[286,] 0 0 0
[287,] 1 4 1
[288,] 1 6 4
[289,] 1 1 0
[290,] 2 1 0
[291,] 1 5 4
[292,] 3 0 3
[293,] 1 2 0
[294,] 2 0 0
[295,] 2 4 1
[296,] 0 0 0
[297,] 0 2 2
[298,] 2 1 0
[299,] 0 1 2
[300,] 1 0 0
[301,] 0 0 0
[302,] 2 2 0
[303,] 0 2 4
[304,] 0 4 6
[305,] 0 3 6
[306,] 3 0 0
[307,] 0 0 0
[308,] 1 3 1
[309,] 0 1 1
[310,] 3 1 0
[311,] 2 1 0
[312,] 1 0 1
[313,] 0 3 4
[314,] 0 2 5
[315,] 3 0 0
[316,] 0 2 1
[317,] 0 3 6
[318,] 0 2 1
[319,] 0 0 0
[320,] 1 0 0
[321,] 0 1 1
[322,] 0 2 2
[323,] 0 5 7
[324,] 1 0 0
[325,] 1 0 0
[326,] 0 2 3
[327,] 0 0 0
[328,] 0 0 0
[329,] 1 1 1
[330,] 0 0 0
[331,] 2 3 1
[332,] 0 1 1
[333,] 0 1 5
[334,] 2 0 1
[335,] 5 0 0
[336,] 0 0 1
[337,] 0 0 0
[338,] 0 0 0
[339,] 2 0 0
[340,] 0 0 0
[341,] 0 3 5
[342,] 3 1 0
[343,] 1 1 3
[344,] 1 4 6
[345,] 2 0 0
[346,] 0 1 2
[347,] 2 0 0
[348,] 2 4 4
[349,] 0 1 2
[350,] 3 0 0
[351,] 0 1 2
[352,] 1 0 0
[353,] 4 0 0
[354,] 0 1 2
[355,] 3 0 3
[356,] 1 4 4
[357,] 0 0 0
[358,] 0 0 1
[359,] 2 1 0
[360,] 0 1 1
[361,] 1 0 0
[362,] 0 3 6
[363,] 0 3 5
[364,] 0 0 0
[365,] 0 1 2
[366,] 2 0 0
[367,] 1 2 5
[368,] 0 4 7
[369,] 2 1 0
[370,] 1 1 0
[371,] 2 6 7
[372,] 8 1 1
[373,] 1 0 0
[374,] 0 0 0
[375,] 1 0 0
[376,] 7 2 0
[377,] 4 1 2
[378,] 2 0 0
[379,] 1 0 0
[380,] 0 2 3
[381,] 1 0 0
[382,] 1 3 6
[383,] 0 0 0
[384,] 0 0 3
[385,] 0 0 0
[386,] 2 5 3
[387,] 2 3 1
[388,] 0 0 0
[389,] 3 2 4
[390,] 0 0 0
[391,] 0 1 3
[392,] 0 2 6
[393,] 0 3 4
[394,] 0 0 0
[395,] 2 0 0
[396,] 0 2 3
[397,] 2 0 0
[398,] 0 0 0
[399,] 3 2 2
[400,] 1 0 0
[401,] 1 0 0
[402,] 4 0 0
[403,] 6 0 1
[404,] 0 0 0
[405,] 3 3 0
[406,] 0 0 0
[407,] 3 0 0
[408,] 0 2 4
[409,] 0 1 3
[410,] 1 0 0
[411,] 1 0 0
[412,] 1 1 2
[413,] 2 4 5
[414,] 2 2 1
[415,] 1 3 2
[416,] 0 0 0
[417,] 0 1 1
[418,] 0 4 6
[419,] 0 0 2
[420,] 3 1 0
[421,] 0 0 1
[422,] 1 0 0
[423,] 1 0 0
[424,] 0 0 0
[425,] 1 0 0
[426,] 0 2 4
[427,] 0 0 0
[428,] 3 5 2
[429,] 2 5 3
[430,] 0 1 1
[431,] 0 0 0
[432,] 1 0 0
[433,] 0 2 3
[434,] 1 0 0
[435,] 0 0 0
[436,] 1 3 0
[437,] 0 1 1
[438,] 0 1 2
[439,] 0 1 1
[440,] 1 3 4
[441,] 0 0 1
[442,] 0 0 0
[443,] 0 0 1
[444,] 2 0 0
[445,] 2 5 4
[446,] 0 1 0
[447,] 5 1 1
[448,] 0 0 0
[449,] 3 0 0
[450,] 1 3 1
[451,] 4 0 0
[452,] 3 2 1
[453,] 1 1 0
[454,] 1 1 3
[455,] 0 1 2
[456,] 1 0 0
[457,] 1 0 0
[458,] 1 0 0
[459,] 1 3 2
[460,] 1 2 0
[461,] 3 6 2
[462,] 0 3 5
[463,] 2 2 0
[464,] 0 4 5
[465,] 0 0 0
[466,] 2 1 3
[467,] 1 1 0
[468,] 0 1 1
[469,] 0 3 5
[470,] 1 2 0
[471,] 1 1 0
[472,] 0 0 1
[473,] 0 0 0
[474,] 2 0 0
[475,] 0 0 0
[476,] 0 3 4
[477,] 1 1 0
[478,] 0 1 1
[479,] 0 0 0
[480,] 0 0 0
[481,] 1 1 1
[482,] 0 0 0
[483,] 1 1 1
[484,] 1 3 4
[485,] 3 0 1
[486,] 3 0 0
[487,] 0 1 3
[488,] 0 0 0
[489,] 2 1 1
[490,] 1 1 0
[491,] 1 1 1
[492,] 1 2 2
[493,] 0 0 0
[494,] 1 0 0
[495,] 1 2 2
[496,] 0 2 2
[497,] 0 1 2
[498,] 4 2 0
[499,] 3 0 0
[500,] 0 1 0
[501,] 3 0 1
[502,] 0 1 0
[503,] 0 0 1
[504,] 0 0 1
[505,] 0 1 1
[506,] 0 4 5
[507,] 5 1 0
[508,] 1 3 5
[509,] 3 0 2
[510,] 0 1 3
[511,] 0 0 1
[512,] 0 0 0
[513,] 4 0 1
[514,] 0 2 2
[515,] 0 0 1
[516,] 3 2 0
[517,] 0 0 1
[518,] 4 0 1
[519,] 3 1 1
[520,] 1 1 2
[521,] 0 1 3
[522,] 5 3 0
[523,] 3 4 1
[524,] 1 5 4
[525,] 0 0 0
[526,] 0 2 1
[527,] 0 0 0
[528,] 0 0 0
[529,] 0 1 4
[530,] 0 1 2
[531,] 0 3 4
[532,] 3 2 2
[533,] 0 1 1
[534,] 2 4 4
[535,] 1 0 0
[536,] 1 6 5
[537,] 0 0 1
[538,] 2 4 1
[539,] 0 0 0
[540,] 3 0 2
[541,] 1 0 0
[542,] 1 0 0
[543,] 0 0 0
[544,] 0 4 5
[545,] 2 1 0
[546,] 0 1 1
[547,] 2 0 0
[548,] 1 7 4
[549,] 0 0 0
[550,] 0 2 3
[551,] 0 2 3
[552,] 1 2 0
[553,] 1 1 2
[554,] 2 1 1
[555,] 2 1 1
[556,] 0 2 2
[557,] 1 0 0
[558,] 2 6 6
[559,] 0 3 5
[560,] 0 2 1
[561,] 0 0 0
[562,] 0 1 2
[563,] 0 0 1
[564,] 1 3 2
[565,] 4 1 2
[566,] 0 0 0
[567,] 3 2 1
[568,] 0 1 0
[569,] 1 4 3
[570,] 3 6 3
[571,] 0 0 0
[572,] 1 0 0
[573,] 0 0 0
[574,] 0 1 1
[575,] 0 0 0
[576,] 0 0 0
[577,] 2 0 0
[578,] 1 0 0
[579,] 0 3 3
[580,] 0 0 0
[581,] 1 1 2
[582,] 0 1 2
[583,] 1 0 0
[584,] 5 2 0
[585,] 1 2 3
[586,] 2 0 0
[587,] 1 0 0
[588,] 1 3 2
[589,] 1 0 0
[590,] 1 1 2
[591,] 0 1 2
[592,] 0 0 1
[593,] 1 0 0
[594,] 2 0 0
[595,] 4 0 0
[596,] 0 2 5
[597,] 1 6 5
[598,] 0 0 0
[599,] 2 3 0
[600,] 0 2 3
[601,] 0 1 2
[602,] 2 0 0
[603,] 1 3 5
[604,] 0 0 0
[605,] 5 1 0
[606,] 0 2 3
[607,] 2 0 1
[608,] 1 2 1
[609,] 3 1 0
[610,] 1 0 0
[611,] 1 0 1
[612,] 1 0 0
[613,] 5 0 0
[614,] 0 2 2
[615,] 0 0 0
[616,] 2 0 2
[617,] 0 2 3
[618,] 0 1 1
[619,] 0 0 0
[620,] 0 4 6
[621,] 0 1 1
[622,] 1 0 0
[623,] 1 0 0
[624,] 1 0 0
[625,] 1 4 4
[626,] 1 0 3
[627,] 1 2 0
[628,] 0 0 0
[629,] 2 1 1
[630,] 1 0 0
[631,] 1 0 0
[632,] 0 3 3
[633,] 0 1 2
[634,] 2 1 2
[635,] 1 1 0
[636,] 0 4 6
[637,] 2 0 0
[638,] 1 1 0
[639,] 2 0 0
[640,] 0 0 0
[641,] 2 5 2
[642,] 1 2 1
[643,] 1 2 2
[644,] 0 0 0
[645,] 0 0 0
[646,] 0 0 0
[647,] 0 1 3
[648,] 5 0 0
[649,] 1 0 0
[650,] 5 2 1
[651,] 0 0 1
[652,] 1 1 0
[653,] 1 2 1
[654,] 0 3 3
[655,] 1 1 0
[656,] 0 0 0
[657,] 1 2 1
[658,] 5 1 1
[659,] 2 0 0
[660,] 0 2 6
[661,] 2 0 1
[662,] 1 1 0
[663,] 4 0 0
[664,] 2 0 1
[665,] 1 2 2
[666,] 1 0 3
[667,] 0 0 0
[668,] 2 0 0
[669,] 0 1 2
[670,] 0 0 0
[671,] 0 3 5
[672,] 3 0 0
[673,] 1 0 0
[674,] 2 0 1
[675,] 1 2 3
[676,] 4 1 2
[677,] 0 4 7
[678,] 0 0 0
[679,] 0 2 5
[680,] 0 2 3
[681,] 1 2 2
[682,] 1 0 0
[683,] 0 1 2
[684,] 1 2 1
[685,] 8 0 0
[686,] 1 3 3
> predict(tf, newdata = GBSG2[1:3,], type = "node")
[[1]]
[1]  7  7 10

[[2]]
[1]  6  7 11

[[3]]
[1] 6 9 9

[[4]]
[1] 10 10 11

[[5]]
[1] 5 9 9

[[6]]
[1] 11 13 13

[[7]]
[1]  9 11 11

[[8]]
[1]  9 13 13

[[9]]
[1] 7 7 8

[[10]]
[1]  5 10 10

[[11]]
[1]  9  7 10

[[12]]
[1] 10 12 12

> (cf <- predict(tf, newdata = GBSG2[1:3,], type = "coef"))
$`1`
    Bs1(y)     Bs2(y)     Bs3(y)     Bs4(y)     Bs5(y)     Bs6(y) 
-5.3572531 -0.9501025 -0.9501026 -0.9501026 -0.5534103 -0.2663592 

$`2`
    Bs1(y)     Bs2(y)     Bs3(y)     Bs4(y)     Bs5(y)     Bs6(y) 
-4.5870980 -0.8194577 -0.8194576 -0.5566826 -0.5566826 -0.1192352 

$`3`
     Bs1(y)      Bs2(y)      Bs3(y)      Bs4(y)      Bs5(y)      Bs6(y) 
-4.57841784 -0.48191518 -0.48191517 -0.36881035 -0.36881036  0.07233486 

> 
> logLik(tf, newdata = GBSG2[1:3,])
'log Lik.' -23.41521 (df=NA)
> 
> sapply(1:length(tf$nodes), function(i) logLik(gettree(tf, i)))
 [1] -1616.124 -1684.884 -1656.536 -1560.266 -1604.822 -1610.935 -1513.001
 [8] -1561.974 -1673.237 -1614.415 -1613.844 -1669.650
> 
> varimp(tf)
     horTh        age   menostat      tsize     tgrade     pnodes    progrec 
-8.8857981  0.6222372  1.6154676 -1.4377032 -3.7035460 17.4688902  8.4864265 
    estrec 
 4.6148580 
> 
> mod <- mlt(m, data = GBSG2)
> logLik(mod)
'log Lik.' -2618.714 (df=6)
> 
> logLik(mod, newdata = GBSG2[1:3,])
'log Lik.' -24.62884 (df=NULL)
> 
> layout(matrix(1:2, nr = 1))
> coef(mod) <- cf[[1]]
> plot(mod, newdata = data.frame(1), type = "survivor")
> coef(mod) <- cf[[2]]
> plot(mod, newdata = data.frame(1), type = "survivor", add = TRUE)
> coef(mod) <- cf[[3]]
> plot(mod, newdata = data.frame(1), type = "survivor", add = TRUE)
> 
> simulate(tf, newdata = GBSG2[1:3,], nsim = 3)
[[1]]
[1] (2000, Inf]      734.438757175429 497.607842377087

[[2]]
[1] 1112.04506047072 751.742244204503 302.216617078849

[[3]]
[1] 879.889929125265 (2000, Inf]      787.669776268473

> 
> cmod <- coxph(Surv(time, cens) ~ horTh + age + menostat + tsize + tgrade +
+     pnodes + progrec + estrec, data = GBSG2)
> 
> plot(survfit(cmod, newdata = GBSG2[1:3,]))
> 
> proc.time()
   user  system elapsed 
 28.072   0.236  28.328 
